# –ê–ø–ª–∏—Ñ—Ç-–º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ç–µ–ª—å–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö

**–¶–µ–ª—å —Ä–∞–±–æ—Ç—ã:** —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥–µ–ª–µ–π PropCare –∏ DLCE, –ø—Ä–æ–≤–µ–¥–µ–Ω–∏–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤ –Ω–∞–¥ —ç—Ç–∏–º–∏ –º–æ–¥–µ–ª—è–º–∏, —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–¥–∞. –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –≤ –¥–∞–Ω–Ω–æ–º –∫–æ–¥–µ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —ç–∫—Å–ø–µ—Ä–µ–º–µ–Ω—Ç–æ–≤ –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤ —Å–∞–º–æ–π —Ä–∞–±–æ—Ç–µ ([–ª–∞—Ç–µ—Ö –≤–µ—Ä—Å–∏—è —Ä–∞–±–æ—Ç—ã](https://ru.overleaf.com/project/686fe80513564e2a218ff4ed))

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- –ü—Ä–æ–µ–∫—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª—Å—è –Ω–∞ Python‚ÄØ3.10 –≤ –ª–∏–Ω—É–∫—Å —Å–∏—Å—Ç–µ–º–µ.
- –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω—ã –≤ —Ñ–∞–π–ª–µ environment.yml. –î–ª—è –Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∏ —Å–∫–∞—á–∞–π—Ç–µ —Ç—É–¥–∞ –æ—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
  ```bash
  conda env create -n uplift_env -f environment.yml
  ```
  –ó–∞—Ç–µ–º –∞–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∏ —Å–∫–∞—á–∞–π—Ç–µ —Ç—É–¥–∞ –º–æ–¥—É–ª—å –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–π –≤ —ç—Ç–æ–º –ø—Ä–æ–µ–∫—Ç–µ —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:
   ```bash
  conda activate uplift_env
  pip install e .
  ```
- –î–ª—è –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π –∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å –≤–∏–¥–µ–æ–∫–∞—Ä—Ç–∞ NVIDIA GeForce RTX‚ÄØ4090
- PyTorch –∏ TensorFlow –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞—é—Ç —Å RTX‚ÄØ4090 –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –¥—Ä–∞–π–≤–µ—Ä–æ–≤ –∏ CUDA Toolkit (–≤–µ—Ä—Å–∏–∏ 11.8 –∏–ª–∏ –ø–æ–∑–¥–Ω–µ–µ).


## –î–∞—Ç–∞—Å–µ—Ç: Dunnhumby ‚Äî The Complete Journey

–ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ [**Dunnhumby: The Complete Journey**](https://www.dunnhumby.com/source-files/)

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

1. –°–∫–∞—á–∞–π—Ç–µ —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å–∞–π—Ç–∞ –¥–∞–Ω–Ω—ã–µ –∏ –ø–æ–º–µ—Å—Ç–∏—Ç–µ –∏—Ö –≤ –ø–∞–ø–∫—É: `./data/raw/`.
2. –ó–∞–ø—É—Å—Ç–∏ `uplift/data/data.ipynb` –∏ –≤—ã–ø–æ–ª–Ω–∏ –≤—Å–µ —è—á–µ–π–∫–∏ (–≤ –Ω–æ–≤–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏ uplift_env).
3. –†–µ–∑—É–ª—å—Ç–∞—Ç–æ–º —Å—Ç–∞–Ω—É—Ç —á–µ—Ç—ã—Ä–µ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã—Ö –ø–∞–ø–∫–∏ —Å CSV‚Äë—Ñ–∞–π–ª–∞–º–∏, —Ä–∞–∑–º–µ—â—ë–Ω–Ω—ã–µ –≤ –ø–∞–ø–∫–µ `data/preprocessed/`:

| –ù–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö               | –§–∞–π–ª                                   |
|---------------------------|----------------------------------------|
| Category‚ÄëOriginal         | `data/preprocessed/dunn_cat_mailer_10_10_1_1/original_rp0.40` |
| Category‚ÄëPersonalized     | `data/preprocessed/dunn_cat_mailer_10_10_1_1/rank_rp0.40_sf2.00_nr210` |
| Product‚ÄëOriginal          | `data/preprocessed/dunn_mailer_10_10_1_1/original_rp0.90` |
| Product‚ÄëPersonalized      | `data/preprocessed/dunn_mailer_10_10_1_1/rank_rp0.90_sf2.00_nr991` |

üìå **–ó–∞–º–µ—á–∞–Ω–∏–µ**: —ç—Ç–∏ –ø—É—Ç–∏ –æ—Å–Ω–æ–≤–∞–Ω—ã –Ω–∞ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ `data.ipynb`.

–ö–æ–¥ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–∞—Ç–∞—Å–µ—Ç–æ–≤ –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è [wonhyung64/causal](https://github.com/wonhyung64/causal) ‚Äî –≥–¥–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç—å–∏ DLCE –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞—Ç–∞—Å–µ—Ç–æ–≤.

### –ö–æ–¥ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –º–æ–¥–µ–ª–µ–π

–ü–µ—Ä–µ–¥ —Ç–µ–º –∫–∞–∫ –æ–±—É—á–∞—Ç—å –º–æ–¥–µ–ª–∏, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –¥–∞—Ç–∞—Å–µ—Ç—ã, —Å–æ–¥–µ—Ä–∂–∞—â—É—é train/vali/test —Ä–∞–∑–±–∏–µ–Ω–∏—è –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ. –î–ª—è —ç—Ç–æ–≥–æ –±—ã–ª–∞ –Ω–∞–ø–∏—Å–∞–Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–≥—Ä—É–∂–∞–µ—Ç –¥–∞—Ç–∞—Å–µ—Ç –ø–æ –µ–≥–æ –Ω–∞–∑–≤–∞–Ω–∏—é —É–∂–µ –≤ –Ω—É–∂–Ω–æ–º –¥–ª—è –Ω–∞—Å –≤–∏–¥–µ:

```python
train_df, vali_df, test_df, num_users, num_items, item_pop = get_dataset(
    name, 
    path_to_data="."
)
````

–≥–¥–µ `name` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –æ–¥–Ω–æ –∏–∑ —á–µ—Ç—ã—Ä—ë—Ö –∑–Ω–∞—á–µ–Ω–∏–π:

* **CO** ‚Äî Category-Original
* **CP** ‚Äî Category-Personalized
* **PO** ‚Äî Product-Original
* **PP** ‚Äî Product-Personalized

a `path_to_data` - —ç—Ç–æ –ø—É—Ç—å –¥–æ –ø–∞–ø–∫–∏ 'data'.

–§—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã:

**train_df**, **vali_df**, **test_df** ‚Äî —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ –≤—ã–±–æ—Ä–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ DataFrame
**num_users**, **num_items** ‚Äî —Ä–∞–∑–º–µ—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∏ —Ç–æ–≤–∞—Ä–Ω–æ–≥–æ —Å–ª–æ–≤–∞—Ä–µ–π
**item_pop** ‚Äî –≤–µ–∫—Ç–æ—Ä –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏ —Ç–æ–≤–∞—Ä–æ–≤

–≠—Ç–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –≥–æ—Ç–æ–≤—ã –∫ –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ –º–æ–¥–µ–ª—è—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ç–µ–ª—å–Ω—ã—Ö —Å–∏—Å—Ç–µ–º. –ù–∏–∂–µ –ø—Ä–∏–≤–µ–¥—ë–Ω –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–∏–º–µ—Ä –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–ª—è –¥–∞—Ç–∞—Å–µ—Ç–∞ CO:

```python
import os
import pandas as pd
import numpy as np
from pathlib import Path
from tqdm import tqdm

from src import *


# –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞—Ç–∞—Å–µ—Ça CO
train_df, vali_df, test_df, num_users, num_items, item_pop = get_dataset(
    'CO',
    path_to_data="."
)

```

## –ú–æ–¥–µ–ª–∏

–í –ø—Ä–æ–µ–∫—Ç–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –¥–≤–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏: **PropCare** –∏ **DLCE**.  

### PropCare

–î–ª—è –Ω–∞—á–∞–ª–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –º–æ–¥–µ–ª–∏ –∏ –∑–∞–¥–∞—Ç—å –∞—Ä–≥—É–º–µ–Ω—Ç—ã.

#### –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–¥–µ–ª–∏ PropCare

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ò—Å—Ç–æ—á–Ω–∏–∫ / –∑–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|---------------------|----------|
| **dimension** | `args.dimension` | –†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –æ–±—ä–µ–∫—Ç–æ–≤. |
| **embedding_layer_units** | `args.embedding_layer_units` | –°–ø–∏—Å–æ–∫ —Ä–∞–∑–º–µ—Ä–æ–≤ —Å–ª–æ—ë–≤ –æ–±—â–µ–π (shared) MLP, –∫–æ—Ç–æ—Ä–∞—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏—é user/item —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤. |
| **estimator_layer_units** | `args.estimator_layer_units` | –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ MLP –¥–ª—è –¥–≤—É—Ö –≤–µ—Ç–æ–∫: **propensity** (p) –∏ **relevance** (r). |
| **lambda_1** | `args.lambda_1` | –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –¥–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–Ω–æ–≥–æ —à—Ç—Ä–∞—Ñ–∞ ùìõ‚Çö‚Çí‚Çö. |
| **lambda_2** | `args.lambda_2` *(–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `1e-4`)* | –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Ä–µ–≥—É–ª—è—Ä–∏–∑–∞—Ü–∏–∏ —Å–∫–ª–æ–Ω–Ω–æ—Å—Ç–µ–π –∫ –ø–æ–∫–∞–∑—É ùìõ·µ£‚Çëg. |
| **lr** | `args.lr` | Learning rate (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä SGD). |
| **ablation_mode** | `args.ablation_mode` *(–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `"default"`)* | –†–µ–∂–∏–º –∞–±–ª—è—Ü–∏–∏: `"NEG"`, `"S1"`, `"NO_P"`, `"NO_R"`, `"NO_P_R"`. –ü–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç–∫–ª—é—á–∞—Ç—å —á–∞—Å—Ç–∏ –º–æ–¥–µ–ª–∏. |

---

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è PropCare

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è PropCare

–ù–∏–∂–µ –ø—Ä–∏–≤–µ–¥—ë–Ω –ø—Ä–∏–º–µ—Ä –ø–æ–ª–Ω–æ–π —Ü–µ–ø–æ—á–∫–∏: –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞—Ç–∞—Å–µ—Ç–∞, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è PropCare, –æ–±—É—á–µ–Ω–∏–µ, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏, –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π –∏ —Ä–∞—Å—á—ë—Ç –ø—Ä–æ–ø–µ–Ω—Å–∏—Ç–∏-–º–µ—Ç—Ä–∏–∫ (KLD, œÑ, F1).

```python
# –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞ CO
train_df, vali_df, test_df, num_users, num_items, item_pop = get_dataset(
    "CO",
    path_to_data="."
)

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –º–æ–¥–µ–ª–∏
class Args:
    dimension = 128
    embedding_layer_units = [256, 128, 64]
    estimator_layer_units = [64, 32, 16, 8]
    lambda_1 = 0.1
    lr = 0.01

args = Args()

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥–µ–ª–∏ PropCare –Ω–∞ –¥–∞—Ç–∞—Å–µ—Ç–µ CO
propcare_model = PropCare(
    num_users=num_users,
    num_items=num_items,
    args=args,
    item_popularity=item_pop,
    device='cuda'
)

# –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏
propcare_model.fit(
    train_df,
    vali_df,
    batch_size=4096,
    epochs=25
)

# –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏
propcare_model.save_model(
    dir_path="saved_models/propcare",
    model_name="propcare_model"
)

# –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏
propcare_model = PropCare.load_model(
    dir_path="saved_models/propcare",
    model_name="propcare_model",
    device='cuda'
)

# –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–µ
preds = propcare_model.predict(test_df)

# –†–∞—Å—á—ë—Ç –ø—Ä–æ–ø–µ–Ω—Å–∏—Ç–∏-–º–µ—Ç—Ä–∏–∫ (KLD, œÑ, F1)
value = propcare_model.get_metrics(test_df, epsilon=0.2)
```

### DLCE

–î–ª—è –Ω–∞—á–∞–ª–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –º–æ–¥–µ–ª–∏ –∏ –∑–∞–¥–∞—Ç—å –∞—Ä–≥—É–º–µ–Ω—Ç—ã.

#### –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–¥–µ–ª–∏ DLCE

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ò—Å—Ç–æ—á–Ω–∏–∫ / –∑–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|---------------------|----------|
| **dim_factor** | `dim_factor` *(–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `100`)* | –†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –æ–±—ä–µ–∫—Ç–æ–≤. |
| **metric** | `metric` *(–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `'upper_bound_log'`)* | –¢–∏–ø –º–µ—Ç—Ä–∏–∫–∏ / —Ü–µ–ª–µ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏, –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–π –≤ DLCE. |
| **learn_rate** | `learn_rate` *(–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `0.001`)* | –°–∫–æ—Ä–æ—Å—Ç—å –æ–±—É—á–µ–Ω–∏—è (learning rate). |
| **reg_factor** | `reg_factor` *(–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `0.01`)* | L2-—Ä–µ–≥—É–ª—è—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è –ª–∞—Ç–µ–Ω—Ç–Ω—ã—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤. |
| **reg_bias** | `reg_bias` *(–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `0.01`)* | L2-—Ä–µ–≥—É–ª—è—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è bias. |
| **omega** | `omega` *(–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `0.05`)* | –ì–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä, –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É—é—â–∏–π —Å—Ç–µ–ø–µ–Ω—å –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ —Å–º–µ—â–µ–Ω–∏—è. |
| **xT** | `xT` *(–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `0.01`)* | –ü–∞—Ä–∞–º–µ—Ç—Ä –æ–±—Ä–∞–±–æ—Ç–∫–∏ treated-—á–∞—Å—Ç–∏ –≤—ã–±–æ—Ä–∫–∏. |
| **xC** | `xC` *(–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `0.01`)* | –ü–∞—Ä–∞–º–µ—Ç—Ä –æ–±—Ä–∞–±–æ—Ç–∫–∏ control-—á–∞—Å—Ç–∏ –≤—ã–±–æ—Ä–∫–∏. |
| **with_bias** | `with_bias` *(–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `True`)* | –í–∫–ª—é—á–µ–Ω–∏–µ user/item bias –∏ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Å–º–µ—â–µ–Ω–∏—è. |
| **with_outcome** | `with_outcome` *(–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `True`)* | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–∏ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π outcome –ø—Ä–∏ –æ–±—É—á–µ–Ω–∏–∏. |
| **only_treated** | `only_treated` *(–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `False`)* | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–∏ —Ç–æ–ª—å–∫–æ –æ–±—ä–µ–∫—Ç—ã —Å `treated = 1` –ø—Ä–∏ –æ–±—É—á–µ–Ω–∏–∏. |
| **tau_mode** | `tau_mode` *(–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `'cips'`)* | –†–µ–∂–∏–º –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ propensity: `'ips'`, `'cips'`, `'naive'`. |
| **seed** | `seed` *(–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `None`)* | Seed –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (–µ—Å–ª–∏ `None`, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `42`). |
| **device** | `device` *(–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `'cuda'`)* | –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è: `'cuda'` –∏–ª–∏ `'cpu'`. |
| **measures** | `measures` *(–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ['CPrec_10', 'CPrec_100', 'CDCG_100', 'CDCG'])* | –ú–µ—Ç—Ä–∏–∫–∏, –≤—ã—á–∏—Å–ª—è–µ–º—ã–µ –ø—Ä–∏ –æ—Ü–µ–Ω–∫–µ –º–æ–¥–µ–ª–∏. |

---

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è DLCE

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è DLCE

–ù–∏–∂–µ –ø—Ä–∏–≤–µ–¥—ë–Ω –ø—Ä–∏–º–µ—Ä –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏, –æ–±—É—á–µ–Ω–∏—è, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏ **DLCE**  —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –Ω–∞–±–æ—Ä–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.

```python
params = {
    "dim_factor": 100,
    "metric": "upper_bound_log",
    "learn_rate": 0.001,
    "reg_factor": 0.01,
    "reg_bias": 0.01,
    "omega": 0.05,
    "xT": 0.01,
    "xC": 0.01,
    "tau_mode": "cips",
    "with_bias": True,
    "with_outcome": True,
    "only_treated": False
}


# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è DLCE –Ω–∞ –¥–∞—Ç–∞—Å–µ—Ç–µ CO
dlce_model = DLCE(
    num_users=num_users,
    num_items=num_items,
    device='cuda',
    **params
)

# –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ –Ω–∞ –¥–∞—Ç–∞—Å–µ—Ç–µ CO
dlce_model.fit(
    train_df,
    vali_df,
    n_epochs=40,
    batch_size=512
)

# –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏
dlce_model.save_model(
    dir_path=f"saved_models/dlce/",
    model_name="model"
)

# –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏
dlce_model = DLCE.load_model(
    dir_path=f"saved_models/dlce/",
    model_name="model",
    device='cuda'
)

# –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è
test_df[f"DLCE_pred"] = dlce_model.predict(test_df)

# –°—á–∏—Ç–∞–µ–º –º–µ—Ç—Ä–∏–∫–∏
evaluator = Evaluator()
evaluator.evaluate(test_df.rename(columns={"DLCE_pred": "pred"}), measures=['CPrec_10', 'CPrec_100', 'CDCG', 'CDCG_100'])
```

